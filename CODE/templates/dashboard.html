<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Dashboard</title>
  <link rel="stylesheet" href="/static/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="theme-root">
  <div class="container">
    <header class="dash-head">
      <h2>Dashboard</h2>
      <div>Welcome, {{ session.username }}</div>
      <a href="/logout">Logout</a>
    </header>

    <section class="grid">
      <div class="card">
        <h3>Upload & Analyze</h3>
        <form id="uploadForm2" enctype="multipart/form-data">
          <input type="file" name="file" id="fileInput2">
          <button type="submit">Upload</button>
        </form>
        <pre id="uploadResult"></pre>
      </div>

      <div class="card">
        <h3>Metrics</h3>
        <canvas id="rocChart2"></canvas>
        <div id="metricsText2"></div>
      </div>

    </section>
  </div>

<script>
const form2 = document.getElementById('uploadForm2');
form2.addEventListener('submit', async (e)=>{e.preventDefault(); const f=document.getElementById('fileInput2'); if(!f.files.length) return alert('choose'); const fd=new FormData(); fd.append('file', f.files[0]); const r=await fetch('/upload',{method:'POST',body:fd}); const j=await r.json(); document.getElementById('uploadResult').innerText=JSON.stringify(j,null,2);});

async function refreshMetrics2(){
  const res = await fetch('/metrics');
  const body = await res.json();
  if (body.message) {
    document.getElementById('metricsText2').innerText = body.message; return;
  }
  document.getElementById('metricsText2').innerText = `Accuracy: ${body.accuracy.toFixed(3)}, F1: ${body.f1.toFixed(3)} AUC: ${body.roc.auc.toFixed(3)}`;
  const ctx = document.getElementById('rocChart2').getContext('2d');
  if (window.rocChart2) window.rocChart2.destroy();
  window.rocChart2 = new Chart(ctx, {
    type: 'line',
    data: {
        labels: body.roc.fpr.map((v, i) => i),
        datasets: [{
            label: 'ROC AUC ' + body.roc.auc.toFixed(3),
            data: body.roc.tpr,
            fill: false
        }]
    },
    options: {
        scales: {
            x: { title: { display: true, text: 'FPR' }},
            y: { title: { display: true, text: 'TPR' }}
        }
    }
});
}
setInterval(refreshMetrics2,5000); refreshMetrics2();
</script>
</body>
</html>